import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Textarea } from '@/components/ui/textarea';
import { Loader2, Sparkles, Star, GitFork, Brain } from 'lucide-react';
import { getCategories } from '@/lib/api';
export function InputPanel({ onGenerate, loading, loadingMessage, steps }) {
    const [prompt, setPrompt] = useState('');
    const [category, setCategory] = useState('');
    const [categories, setCategories] = useState([]);
    useEffect(() => {
        getCategories().then(setCategories).catch(console.error);
    }, []);
    const handleSubmit = (e) => {
        e.preventDefault();
        if (prompt.length >= 10 && !loading) {
            onGenerate(prompt, category || undefined);
        }
    };
    // Extract unique skills used across all steps
    const usedSkills = steps.flatMap(step => step.sources);
    const uniqueSkills = Array.from(new Map(usedSkills.map(s => [s.skillId, s])).values()).slice(0, 5);
    return (_jsxs("div", { className: "h-full flex flex-col p-6", children: [_jsxs("h2", { className: "text-lg font-semibold mb-4 flex items-center gap-2", children: [_jsx(Sparkles, { className: "w-5 h-5 text-gold" }), "Describe Your Skill"] }), uniqueSkills.length === 0 && (_jsx("div", { className: "mb-4 p-4 rounded-lg border border-border bg-secondary/30", children: _jsxs("div", { className: "flex items-start gap-3", children: [_jsx(Brain, { className: "w-5 h-5 text-gold mt-0.5 shrink-0" }), _jsxs("div", { children: [_jsx("h3", { className: "text-sm font-medium text-foreground mb-1", children: "Powered by Proven Skills" }), _jsx("p", { className: "text-xs text-muted-foreground leading-relaxed", children: "Your agent skill will be generated by learning from top-rated community skills, proven patterns, and best practices from popular creators." })] })] }) })), _jsxs("form", { onSubmit: handleSubmit, className: "flex-1 flex flex-col", children: [_jsx(Textarea, { placeholder: "Describe the skill you want to create. For example: 'A skill that helps format and lint TypeScript code before committing to git'", value: prompt, onChange: (e) => setPrompt(e.target.value), className: "flex-1 min-h-[150px] resize-none", maxLength: 500, disabled: loading }), _jsxs("div", { className: "flex items-center justify-between mt-2 text-xs text-muted-foreground", children: [_jsxs("span", { children: [prompt.length, "/500 characters"] }), prompt.length < 10 && prompt.length > 0 && (_jsx("span", { className: "text-destructive", children: "Min 10 characters required" }))] }), _jsxs("div", { className: "mt-4", children: [_jsx("label", { className: "text-sm text-muted-foreground mb-2 block", children: "Category (optional)" }), _jsxs("select", { value: category, onChange: (e) => setCategory(e.target.value), className: "w-full rounded-md border border-border bg-background px-3 py-2 text-sm", disabled: loading, children: [_jsx("option", { value: "", children: "All categories" }), categories.map((cat) => (_jsx("option", { value: cat, children: cat }, cat)))] }), category && (_jsx("p", { className: "text-xs text-muted-foreground mt-1", children: "We'll prioritize top-rated skills in this category" }))] }), _jsx(Button, { type: "submit", className: "mt-6 bg-gradient-to-r from-gold-dark via-gold to-gold-light text-background font-semibold hover:opacity-90", disabled: prompt.length < 10 || loading, size: "lg", children: loading ? (_jsxs(_Fragment, { children: [_jsx(Loader2, { className: "w-4 h-4 mr-2 animate-spin" }), loadingMessage || 'Generating...'] })) : (_jsxs(_Fragment, { children: [_jsx(Sparkles, { className: "w-4 h-4 mr-2" }), "Generate Skill"] })) })] }), uniqueSkills.length > 0 && (_jsxs("div", { className: "mt-6 pt-6 border-t border-border", children: [_jsxs("h3", { className: "text-sm font-medium text-foreground mb-1 flex items-center gap-2", children: [_jsx(Star, { className: "w-4 h-4 text-gold" }), "Built on Proven Skills"] }), _jsx("p", { className: "text-xs text-muted-foreground mb-3", children: "Your skill learned from these top-rated patterns:" }), _jsx("div", { className: "space-y-2", children: uniqueSkills.map((skill) => (_jsxs("a", { href: `/skills/${skill.skillId}`, target: "_blank", rel: "noopener noreferrer", className: "flex items-center justify-between p-2 rounded-lg hover:bg-muted/50 transition-colors cursor-pointer", children: [_jsx("span", { className: "text-sm text-foreground", children: skill.skillName }), _jsxs("div", { className: "flex items-center gap-3 text-xs text-muted-foreground", children: [_jsxs("span", { className: "flex items-center gap-1", children: [_jsx(Star, { className: "w-3 h-3 fill-gold text-gold" }), (skill.stars || 0) >= 1000 ? `${((skill.stars || 0) / 1000).toFixed(1)}k` : (skill.stars || 0).toLocaleString()] }), (skill.forks || 0) > 0 && (_jsxs("span", { className: "flex items-center gap-1", children: [_jsx(GitFork, { className: "w-3 h-3" }), (skill.forks || 0) >= 1000 ? `${((skill.forks || 0) / 1000).toFixed(1)}k` : (skill.forks || 0).toLocaleString()] }))] })] }, skill.skillId))) })] }))] }));
}
